# Proxmox admin scripts

Набор небольших Bash-скриптов для автоматизации типовых задач администрирования Proxmox VE: ежедневный health-check, контроль бэкапов и инвентаризация виртуальных машин.

## Требования

- Proxmox VE (проверено на PVE 8.x)
- Настроенный `msmtp` с аккаунтом `pve@ik2.ru` (или другим почтовым ящиком-отправителем)
- Доступ к узлу по root/ssh для установки скриптов и cron-заданий

## Скрипты

### 1. pve-health.sh

Ежедневная проверка состояния узла Proxmox и отправка отчёта на e-mail.

Собирает:
- uptime и load average
- использование памяти и дисков
- топ процессов по CPU и RAM

Пример строки для cron (ежедневно в 07:00):

0 7 * * * /usr/local/sbin/pve-health.sh


### 2. pve-backup-check.sh

Проверка статуса последних задач резервного копирования vzdump.

Собирает:
- список последних задач `vzdump` с помощью `pvesh get /nodes/<node>/tasks`
- отдельно выводит задания со статусом, отличным от `OK` (например, `job errors`)

Может выполняться, например, один раз в день после ночных бэкапов.

### 3. pve-vm-inventory.sh

Быстрая инвентаризация виртуальных машин на узле.

Собирает:
- ID, имя и статус из `qm list`
- выделенные ресурсы (vCPU и RAM) из `/etc/pve/qemu-server/<VMID>.conf`

Результат отправляется на e-mail в виде текстовой таблицы.

## Установка

1. Скопировать скрипты на узел Proxmox, например в `/usr/local/sbin` или отдельный каталог:

git clone https://github.com/ik2vova/admin-script.git
cd admin-script
cp pve-.sh /usr/local/sbin/
chmod +x /usr/local/sbin/pve-.sh


2. Убедиться, что `msmtp` настроен и отправка почты от имени технического ящика работает.

3. По необходимости добавить скрипты в `crontab` пользователя `root`.

